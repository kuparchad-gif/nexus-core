<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Runbooks</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; line-height: 1.5; max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
code, pre { background:#f5f5f7; border-radius:8px; padding:.25rem .5rem; }
pre { overflow-x:auto; padding:1rem; }
table { border-collapse: collapse; width:100%; }
th, td { border:1px solid #e6e6eb; padding:.5rem .6rem; text-align:left; }
thead th { background:#fafbfc; }
h1,h2,h3 { margin-top:1.2rem; }
blockquote { border-left:3px solid #ddd; margin:1rem 0; padding:.5rem 1rem; color:#444; background:#fafafa; }
kbd { background:#eee; border-radius:4px; padding:.15rem .35rem; border:1px solid #ccc; box-shadow: inset 0 -1px 0 #bbb; }
</style>
</head>
<body>
<h1>Runbooks</h1>

<h2>Runbooks</h2>
<h3>Bring‑up</h3>
<ol>
<li>Copy <code>.env.example</code> → <code>.env</code>, set <code>CONSENT_TOKEN</code>.</li>
<li><code>./scripts/deploy.ps1</code></li>
<li>Open Grafana → check <b>Viren Receipts</b> dashboard.</li>
</ol>

<h3>Health Checks</h3>
<ul>
<li>Viren <code>/health</code> → <code>{ ok: true }</code></li>
<li>Loki <code>/ready</code> → <code>200</code></li>
<li>Promtail accepts pushes on <code>:3500</code></li>
<li>Grafana <code>:3000</code> up</li>
</ul>

<h3>Incident Playbook</h3>
<ul>
<li><b>Denies spike:</b> Explore query <code>{app="viren"} | json | decision="deny"</code>, inspect <code>reason</code>; tune <code>policies.yaml</code> if appropriate.</li>
<li><b>Redis down:</b> Receipts still in stdout; restart Redis.</li>
<li><b>NATS down:</b> HTTP path works; restart NATS; watch Viren logs.</li>
<li><b>Loki/Promtail down:</b> Restart <code>promtail</code>, then <code>loki</code>.</li>
</ul>

<h3>Backup/Restore</h3>
<ul>
<li>Loki volume <code>loki-data</code>.</li>
<li>Grafana volume <code>grafana-storage</code> for dynamic dashboards.</li>
<li>Redis receipts export: <code>LRANGE viren:receipts 0 -1</code>.</li>
</ul>

<h3>Release Checklist</h3>
<ul>
<li>Update deps, review policy thresholds.</li>
<li><code>./scripts/deploy.ps1 -Rebuild</code></li>
<li>Verify health + smoke test <code>/authorize</code>.</li>
<li>Tag release <code>sprint-pack-v1.x</code>.</li>
</ul>

<footer><hr><p><small>Generated: 2025-09-09 07:04:45 </small></p></footer>
</body>
</html>